# Huawei-CodeCraft2019

队名：好事花生

初赛：成渝第13名

复赛：成渝第5名


由于种种原因（技术水平差），没有写判题器。羡慕写判题器的大神，比赛的时候还能多一个调参的途径。

## **主要思想**

1. 采用路线动态规划的思想，每发一辆车后实时更新路长，按照dijkstra方法寻找最短路，希望尽量利用到所有的路。

2. 基于1，将所有路的路长均设为相同（10）。

3. 没有写判题器，发车策略就比较简单，直接固定每秒发多少辆车。所有预置车辆都发完后可将该值增大。

4. 发车时按照路口遍历发车，希望相邻的车离得尽量的远。

5. 复赛需求变更后，采取把最后10%的预置车辆修改路线的方法。对地图1有效，系统调度时间能下降100，地图2一直跑不出来，将每秒发车数减15都跑不出来（原因未知）。

## **细节(一些神奇的参数)**

1. 地图更新方法

```python
map_cross[start][end][0] = map_cross[start][end][0] + road_importance[path[1][j]]/l
```

其中road_importance为路的权重：

```python
# road_importance = 1000/(channel+length/80)
road_importance[key] = 1000/(road[key][2]+road[key][1]/80)
```

road_importance最开始只是认为它与路宽和速度应该成反比，所以直接采用了它们的导数，后续慢慢发现由于均匀发车的原因，快车慢车混合，快车只能跟着慢车的速度走，速度影响不是很大，然后加入了长度。

80是我队友花了很久试出来的（我队友对调参很有心得，很多奇怪的参数都是他调出来的），下面的参数l也是他想到的。

```python
l = math.log(len(path[0]) - 1, 7)
```

当时我认为经过的路径对路的影响与车子跑的距离无关，而我队友认为路长短的车可以尽快跑出地图，减小地图的负重。

2. 地图路径长度

开始一直是使用实际长度的，也是我神奇的队友闲来无事试着把长度设为一致，能让车更平均的跑整张地图。这个对分数影响很大，好像是当时直接涨了200分。

3. 路口排序

对路口排序是希望车子的初始出发距离相对较远，以达到避免死锁的目的。

排序的基本思想是：选一个未排序节点，满足它距离当前所有已排序节点的最短路径最长。

## **一些其它不成功的尝试**

**进行了好多复杂的尝试，最后感觉，越简单的反而约好用。**后来我队友怼我的尝试就会说，这么复杂，一定不好用。。。

1. 权重释放

我们基本的思想是希望车能更加平均的跑，但是最后统计道路利用率的时候，最高的有16000多的车跑过，最低的只有几十。开始想释放权重能不能有所优化。

感觉一直不释放权重导致的主要问题是，权重比较低的路由于累计效应，边的最终会比权重较高的路低很多，会导致车辆后期倾向于跑权重低的路。但是当地图上车辆较多的时候，路的容量优势应该不是很明显了才对。

尝试过：

   1. 直接释放权重，但是我们没有判题器，所以也做不到准确的释放权重，尝试每隔一段时间释放部分车辆，隔200，300，400，...，1200都没什么改进。

   2. 每隔一段时间对图进行一定的缩放。

   3. 每隔一段时间对全图路长都进行一定量的减小。

当然，无一例外，都失败了。

2. 按速度分地图

到目前为止的发车方案其实不管车的速度还是路的速度都没有用上，只要快的车和慢的车一起跑，快的车总是会被慢的车托后腿的，就希望快的车可以多使用速度上限高的路，慢的车可以多使用速度上限低的路。

做过的尝试：

   1. 若慢的车跑到了快的路上，将这条路的权重加倍增加。

   2. 直接为每一种车速适配一张地图，路长为该车速的车通过这条路所用的时间，若是有低速的车跑到这条路上，会对当前车速对应地图的路长造成成倍的打击。

以上尝试，当然，也失败了。

## **其它**

参加初赛的时候，目标真的就是可以拿个手环，一度感觉我们队怕是连初赛都过不了了。后来进了复赛，反而是觉得自己有一拼之力，止步复赛了。有点遗憾，不过复赛训练赛也一直是六七名（在有大佬藏分的前提下），最后第五，也是可以了。
